{% extends 'base.html' %}
{% load humanize %}
{% load seo_tags %}
{% load static %}

{% block meta_description %}Buy, sell, and collect trading cards, comics, action figures, and more on HeroesAndMore. Track collection values, browse price guides, and join thousands of collectors.{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "HeroesAndMore",
  "url": "{{ site_url }}",
  "logo": "{% absolute_static 'images/logo-transparent.png' %}",
  "description": "The Premium Collectables Marketplace and Auction House",
  "sameAs": []
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "HeroesAndMore",
  "url": "{{ site_url }}",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ site_url }}/items/search/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="container position-relative">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <p class="text-uppercase fw-semibold mb-3" style="color: var(--gray-400); letter-spacing: 0.1em; font-size: 0.85rem;">The Premium Collectables Marketplace and Auction House</p>
                <h1>Buy. Sell. Collect.</h1>
                <p class="lead mb-4">Join thousands of collectors trading cards, comics, figures, and more. Track your collection's value and discover rare finds.</p>
                <div class="d-flex flex-wrap gap-3">
                    <a href="{% url 'marketplace:listing_list' %}" class="btn btn-light btn-lg">
                        Explore Marketplace
                    </a>
                    {% if not user.is_authenticated %}
                    <a href="{% url 'account_signup' %}" class="btn btn-outline-light btn-lg">
                        Create Free Account
                    </a>
                    {% else %}
                    <a href="{% url 'marketplace:listing_create' %}" class="btn btn-outline-light btn-lg">
                        <i class="bi bi-plus-lg me-2"></i>List an Item
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="col-lg-5 d-none d-lg-block text-end">
                <div class="position-relative">
                    <!-- Logo watermark behind cards -->
                    <img src="{% static 'images/logo-transparent.png' %}" alt="" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; height: auto; opacity: 0.08; pointer-events: none; z-index: 0;">
                    <!-- Floating cards visual -->
                    <div class="d-flex justify-content-end gap-3" style="position: relative; z-index: 1;">
                        <div style="width: 140px; height: 190px; background: linear-gradient(135deg, #E63946 0%, #C62D39 100%); border-radius: 12px; transform: rotate(-6deg); box-shadow: 0 25px 50px rgba(0,0,0,0.3);"></div>
                        <div style="width: 140px; height: 190px; background: linear-gradient(135deg, #00B4D8 0%, #48CAE4 100%); border-radius: 12px; transform: rotate(3deg) translateY(-20px); box-shadow: 0 25px 50px rgba(0,0,0,0.3);"></div>
                        <div style="width: 140px; height: 190px; background: linear-gradient(135deg, #FFB703 0%, #FFC733 100%); border-radius: 12px; transform: rotate(-2deg) translateY(10px); box-shadow: 0 25px 50px rgba(0,0,0,0.3);"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Stats Bar -->
{% if stat_active_listings or stat_collectors %}
<section class="stats-bar d-none d-md-block">
    <div class="container">
        <div class="row">
            <div class="col-3">
                <div class="stat-item">
                    <div class="stat-value">{{ stat_active_listings|intcomma }}</div>
                    <div class="stat-label">Active Listings</div>
                </div>
            </div>
            <div class="col-3">
                <div class="stat-item">
                    <div class="stat-value">{{ stat_collectors|intcomma }}</div>
                    <div class="stat-label">Collectors</div>
                </div>
            </div>
            <div class="col-3">
                <div class="stat-item">
                    <div class="stat-value">${{ stat_sold_total|intcomma }}</div>
                    <div class="stat-label">Items Sold</div>
                </div>
            </div>
            <div class="col-3">
                <div class="stat-item">
                    <div class="stat-value">{% if stat_avg_rating %}{{ stat_avg_rating }}{% else %}-{% endif %}</div>
                    <div class="stat-label">Avg Rating</div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Ending Soon â€” FOMO Grid -->
{% if ending_soon %}
<section class="section section-alt">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-clock" style="color: var(--accent-warning);"></i>
                Ending Soon &mdash; Don't Miss Out
            </h2>
            <a href="{% url 'marketplace:listing_list' %}?type=auction&sort=ending" class="btn btn-outline-dark btn-sm">All Auctions</a>
        </div>
        <div class="row g-4">
            {% for listing in ending_soon %}
            <div class="col-6 col-md-4 col-lg-3">
                {% include 'components/listing_card.html' with listing=listing show_time=True %}
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Featured Lots (Recently Listed) -->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Featured Lots</h2>
            <a href="{% url 'marketplace:listing_list' %}?sort=newest" class="btn btn-outline-dark btn-sm">View All</a>
        </div>
        <div class="row g-4">
            {% for listing in recent_listings %}
            <div class="col-6 col-md-4 col-lg-3 col-xl-2">
                {% include 'components/listing_card.html' with listing=listing %}
            </div>
            {% empty %}
            <div class="col-12">
                <div class="text-center py-5">
                    <div class="mb-3">
                        <i class="bi bi-inbox display-1 text-muted"></i>
                    </div>
                    <h5>No listings yet</h5>
                    <p class="text-muted mb-4">Be the first to list an item on the marketplace.</p>
                    <a href="{% url 'marketplace:listing_create' %}" class="btn btn-dark">Create Listing</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Bid Wars Happening Now -->
{% if bid_wars %}
<section class="section" style="background: linear-gradient(180deg, var(--gray-50) 0%, #fff 100%);">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-lightning-fill" style="color: var(--brand-primary);"></i>
                Bid Wars Happening Now
            </h2>
        </div>
        <div class="row g-4">
            {% for listing in bid_wars %}
            <div class="col-6 col-md-4 col-lg-2">
                <div class="bid-war-card">
                    {% include 'components/listing_card.html' with listing=listing show_time=True %}
                    <div class="bid-war-overlay">
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-lightning-fill"></i> +{{ listing.recent_bids }} bids
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Browse Categories -->
<section class="section section-alt">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Browse Categories</h2>
            <a href="{% url 'items:category_list' %}" class="btn btn-outline-dark btn-sm">View All</a>
        </div>
        <div class="row g-3">
            {% for category in categories %}
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <a href="{{ category.get_absolute_url }}" class="category-card h-100">
                    <i class="bi {{ category.icon|default:'bi-box' }} icon"></i>
                    <span class="name">{{ category.name }}</span>
                </a>
            </div>
            {% empty %}
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <a href="#" class="category-card h-100">
                    <i class="bi bi-suit-spade icon"></i>
                    <span class="name">Trading Cards</span>
                </a>
            </div>
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <a href="#" class="category-card h-100">
                    <i class="bi bi-book icon"></i>
                    <span class="name">Comics</span>
                </a>
            </div>
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <a href="#" class="category-card h-100">
                    <i class="bi bi-person-standing icon"></i>
                    <span class="name">Action Figures</span>
                </a>
            </div>
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <a href="#" class="category-card h-100">
                    <i class="bi bi-controller icon"></i>
                    <span class="name">Video Games</span>
                </a>
            </div>
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <a href="#" class="category-card h-100">
                    <i class="bi bi-vinyl icon"></i>
                    <span class="name">Funko Pops</span>
                </a>
            </div>
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <a href="#" class="category-card h-100">
                    <i class="bi bi-currency-dollar icon"></i>
                    <span class="name">Coins</span>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Curated for Serious Collectors -->
{% if curated_listings %}
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-gem" style="color: var(--brand-gold);"></i>
                Curated for Serious Collectors
            </h2>
        </div>
        <div class="row g-4">
            {% for listing in curated_listings %}
            <div class="col-6 col-md-4 col-lg-3">
                {% include 'components/listing_card.html' with listing=listing %}
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Official Platform Auctions -->
{% if platform_events %}
<section class="section section-alt">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-shield-check" style="color: var(--accent-warning);"></i>
                Official Auctions
            </h2>
            <a href="{% url 'marketplace:platform_auctions' %}" class="btn btn-outline-dark btn-sm">View All</a>
        </div>
        <div class="row g-4">
            {% for event in platform_events %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 border-0 shadow-sm" style="overflow: hidden;">
                    {% if event.cover_image %}
                    <a href="{% url 'marketplace:platform_auction_detail' slug=event.slug %}">
                        <img src="{{ event.cover_image.url }}" class="card-img-top" alt="{{ event.name }}" style="height: 180px; object-fit: cover;">
                    </a>
                    {% else %}
                    <a href="{% url 'marketplace:platform_auction_detail' slug=event.slug %}" class="d-flex align-items-center justify-content-center" style="height: 180px; background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);">
                        <i class="bi bi-hammer text-white" style="font-size: 2.5rem; opacity: 0.5;"></i>
                    </a>
                    {% endif %}
                    <div class="card-body">
                        <div class="d-flex align-items-center gap-2 mb-2">
                            {% if event.is_live %}
                            <span class="badge bg-danger">Live Now</span>
                            {% else %}
                            <span class="badge bg-info text-white">Upcoming</span>
                            {% endif %}
                            <span class="badge bg-warning text-dark"><i class="bi bi-shield-check"></i> Official</span>
                        </div>
                        <h5 class="card-title fw-bold mb-2">
                            <a href="{% url 'marketplace:platform_auction_detail' slug=event.slug %}" class="text-decoration-none text-dark">
                                {{ event.name }}
                            </a>
                        </h5>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">{{ event.total_lots }} lot{{ event.total_lots|pluralize }}</span>
                            {% if event.is_live %}
                            <span class="text-danger small fw-bold"><i class="bi bi-clock"></i> Ends {{ event.bidding_end|naturaltime }}</span>
                            {% else %}
                            <span class="text-primary small fw-bold"><i class="bi bi-clock"></i> Starts {{ event.bidding_start|naturaltime }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Why Heroes & More -->
<section class="section" style="position: relative; overflow: hidden;">
    <img src="{% static 'images/logo-transparent.png' %}" alt="" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; opacity: 0.04; pointer-events: none;">
    <div class="container position-relative">
        <div class="text-center mb-5">
            <h2 class="mb-3">Why Heroes &amp; More</h2>
        </div>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-percent"></i>
                    </div>
                    <h5 class="feature-title">Lower Fees. Higher Returns.</h5>
                    <p class="feature-desc">Starting at 5.95% commission &mdash; a fraction of what the big platforms charge. More of your money stays where it belongs: with you.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-heart"></i>
                    </div>
                    <h5 class="feature-title">Collector-First Marketplace</h5>
                    <p class="feature-desc">Built by collectors, for collectors. Price tracking, collection management, and a community that speaks your language.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-award"></i>
                    </div>
                    <h5 class="feature-title">Built for Serious Buyers &amp; Sellers</h5>
                    <p class="feature-desc">Trusted Seller badges, buyer protection, graded item support, and curated platform auctions for the best inventory.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- WHERE LEGENDS LIVE Final CTA -->
<section class="section" style="background: var(--gradient-hero); color: #fff; padding: 5rem 0; position: relative;">
    <img src="{% static 'images/logo-transparent.png' %}" alt="" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; opacity: 0.06; pointer-events: none;">
    <div class="container text-center position-relative">
        <h2 style="font-size: 3rem; font-weight: 800; color: #fff; letter-spacing: -0.02em;">WHERE LEGENDS LIVE</h2>
        <p style="color: rgba(255,255,255,0.7); font-size: 1.15rem; max-width: 500px; margin: 1rem auto 2rem;">
            The premium destination for serious collectors. Start bidding or consign your collection today.
        </p>
        <div class="d-flex flex-wrap justify-content-center gap-3">
            <a href="{% url 'marketplace:listing_list' %}?type=auction" class="btn btn-light btn-lg">Start Bidding</a>
            <a href="{% url 'sell' %}" class="btn btn-outline-light btn-lg">Consign With Us</a>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Countdown ticker for all [data-countdown] elements
(function() {
    var countdowns = document.querySelectorAll('[data-countdown]');
    if (!countdowns.length) return;

    function updateCountdowns() {
        var now = new Date().getTime();
        countdowns.forEach(function(el) {
            var end = new Date(el.getAttribute('data-countdown')).getTime();
            var diff = end - now;
            if (diff <= 0) {
                el.textContent = 'Ended';
                el.closest('.time-remaining')?.classList.add('text-muted');
                return;
            }
            var d = Math.floor(diff / 86400000);
            var h = Math.floor((diff % 86400000) / 3600000);
            var m = Math.floor((diff % 3600000) / 60000);
            var s = Math.floor((diff % 60000) / 1000);
            if (d > 0) {
                el.textContent = d + 'd ' + h + 'h';
            } else if (h > 0) {
                el.textContent = h + 'h ' + m + 'm';
            } else if (m > 0) {
                el.textContent = m + 'm ' + s + 's';
            } else {
                el.textContent = s + 's';
            }
            // Urgency classes
            var parent = el.closest('.time-remaining');
            if (parent) {
                if (diff < 10000) {
                    parent.classList.add('urgency-critical');
                    parent.classList.remove('urgency-warning');
                } else if (diff < 60000) {
                    parent.classList.add('urgency-warning');
                    parent.classList.remove('urgency-critical');
                }
            }
        });
    }

    updateCountdowns();
    setInterval(updateCountdowns, 1000);
})();
</script>
{% endblock %}
